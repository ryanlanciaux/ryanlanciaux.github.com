
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Vagrantfile for Octopress - Ryan Lanciaux</title>
  <meta name="author" content="Ryan Lanciaux">

  
  <meta name="description" content="I&#8217;ve recently started using Vagrant for managing lightweight virtual machines for various projects. Vagrant is awesome because it allows you to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ryanlanciaux.github.com/blog/2014/05/13/vagrantfile-for-octopress">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ryan Lanciaux" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ryan Lanciaux</a></h1>
  
    <h2>Random programming blog.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ryanlanciaux.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Vagrantfile for Octopress</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-13T03:59:00+00:00" pubdate data-updated="true">May 13<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&#8217;ve recently started using <a href="http://www.vagrantup.com">Vagrant</a> for managing lightweight virtual machines for various projects. Vagrant is awesome because it allows you to:</p>

<ol>
<li><strong>Configure an environment for a specific project / application</strong> &#8211; For instance, if you want to install Ruby / Rails and a mongo database, you can set up an environment specifically for your project. You don&#8217;t need to worry about messing up another project&#8217;s requirements because each project can have it&#8217;s own!</li>
<li><strong>Save system resources</strong> &#8211; Vagrant starts Virtual Machines in headless mode (no UI) &#8211; the VM I&#8217;m using for my blog (which we&#8217;ll see more in a second) is only using 512megs of RAM and it runs without any hiccups. Additionally, these VMs take virtually no hard-drive space when you are not using them. When you&#8217;re done using a machine, you can remove it, keeping only the Vagrantfile and provision scripts. Your scripts can be run later on and your environment will be setup exactly as it was the last time it was configured.</li>
<li><strong>Edit all your code from your host machine</strong> &#8211; Often times with development VMs, I would treat the machine as if it was a standalone computer (installing vim / sublime, etc. etc). Using Vagrant, however, you can edit the code on the host machine and simply run/serve the application with the VM (it should be noted you definitely could do this with standard VMs &#8211; it&#8217;s just a bit easier with Vagrant). As a developer who is pretty OCD about IDE configuration, this is a fantastic feature.</li>
<li><strong>Easily share machines with other developers</strong> &#8211; Vagrant cuts down on the need for sharing giant virtual machines between different computers / developers. You can simply share your Vagrantfile and provision scripts and you have the same environment on any machine (assuming that machine can run Vagrant, etc.).</li>
</ol>


<h2>Vagrant File</h2>

<p>We are going to walk through the Vagrantfile and provisioning script I&#8217;m using for my blog. First off, the <a href="https://docs.vagrantup.com/v2/vagrantfile/index.html">Vagrantfile</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VAGRANTFILE_API_VERSION = "2"
</span><span class='line'>
</span><span class='line'>Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
</span><span class='line'>  config.vm.box = "precise64"
</span><span class='line'>  config.vm.box_url = "http://files.vagrantup.com/precise64.box"
</span><span class='line'>
</span><span class='line'>  config.vm.provision :shell, :path =&gt; "bootstrap.sh"
</span><span class='line'>  config.vm.network :private_network, ip: '10.0.33.36'
</span><span class='line'>  config.ssh.forward_agent = true
</span><span class='line'>
</span><span class='line'>  config.vm.synced_folder "../octopress", "/home/vagrant/octopress", create: false
</span><span class='line'>
</span><span class='line'>  config.vm.provider :virtualbox do |vb|
</span><span class='line'>    vb.customize ["setextradata", :id, "VBoxInternal2/SharedFoldersEnableSymlinksCreate/v-root", "1"]
</span><span class='line'>    vb.customize ["modifyvm", :id, "--memory", "512"]
</span><span class='line'>  end
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>Vagrant files are written in Ruby, however, you don&#8217;t need to know Ruby to use Vagrant &#8211; the configuration code is nothing too crazy. Lets walk through some of the more interesting parts of the Vagrantfile&#8230;</p>

<h4>Box settings</h4>

<p>The first thing we are doing in the configuration block is defining the type of machine to use. Precise64 is a 64bit Ubuntu 12.04 machine. I generally use this one but there are <a href="https://vagrantcloud.com/discover/featured">quite a few to choose from</a> in the <a href="https://vagrantcloud.com/">Vagrant Cloud</a>. With <code>box_url</code> we are describing where this box can be downloaded if it is not currently available on the host machine.</p>

<h4>Provision settings</h4>

<p>Next, we are telling Vagrant to run this <code>bootstrap.sh</code> as part of it&#8217;s <a href="https://docs.vagrantup.com/v2/provisioning/index.html">provisioning</a> process. Provisioning is where we will define what the environment should look like so it&#8217;s not just a base Ubuntu machine. You can provision a Vagrant box with Chef, Puppet, etc. but for this post I&#8217;m just using a shell script (still learning Chef). We will take a look at this shell script in a little bit.</p>

<h4>Network / Sync settings</h4>

<p>Following the vm configuration, we are setting up the networking and folder options for our box. The <code>vm.network</code> property is stating that when there is a webserver running on this machine, we can access it on our host browser at &#8216;10.0.33.36&#8217;. The <code>synced_folder</code> property is stating that the folder <code>octopress</code> living in a sibling folder to the folder that the Vagrantfile is contained in should be accessible within the virtual machine as <code>~/octopress</code>. The octopress directory already exists (and has it&#8217;s own github repo) so we do not want to recreate it.</p>

<h4>Additional settings</h4>

<p>Finally, in the provider block toward the bottom of this script we are adjusting the memory used and setting a property that allows us to use symbolic links.</p>

<h2>Provisioning Script</h2>

<p>As we talked about earlier, the provisioning script is what differentiates our box from a base Ubuntu machine. In the case of this example it&#8217;s basically just a shell script.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/env bash
</span><span class='line'>HOME="/home/vagrant"
</span><span class='line'>PROV_FILE=.vagrant_provision.lock
</span><span class='line'>
</span><span class='line'>#inspired by https://github.com/junwatu/nodejs-vagrant 
</span><span class='line'>if [ -f $PROV_FILE ];
</span><span class='line'>then
</span><span class='line'>    echo "Already Provisioned"
</span><span class='line'>else
</span><span class='line'>    touch $PROV_FILE
</span><span class='line'>
</span><span class='line'>    sudo apt-get install -y git make
</span><span class='line'>
</span><span class='line'>    git clone https://github.com/sstephenson/rbenv.git $HOME/.rbenv
</span><span class='line'>
</span><span class='line'>    # Install ruby-build
</span><span class='line'>    git clone https://github.com/sstephenson/ruby-build.git $HOME/.rbenv/plugins/ruby-build
</span><span class='line'>
</span><span class='line'>    $HOME/.rbenv/bin/rbenv install 1.9.3-p194
</span><span class='line'>    $HOME/.rbenv/bin/rbenv global 1.9.3-p194
</span><span class='line'>
</span><span class='line'>    #Add rbenv to PATH
</span><span class='line'>    echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; $HOME/.profile
</span><span class='line'>    echo 'eval "$(rbenv init -)"' &gt;&gt; $HOME/.profile
</span><span class='line'>
</span><span class='line'>    #own rbenv as the vagrant user
</span><span class='line'>    sudo chown -Rf vagrant $HOME/.rbenv
</span><span class='line'>
</span><span class='line'>    #don't like doing this
</span><span class='line'>    sudo su - vagrant -c "rbenv rehash && cd /home/vagrant/octopress/ && gem install bundler"
</span><span class='line'>    sudo su - vagrant -c "cd /home/vagrant/octopress/ && bundle install"
</span><span class='line'>fi</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;m not going to spend as much time on this as it&#8217;s not too interesting if you know shell scripting (and there is probably a better way to do a lot of this).</p>

<ol>
<li>Check to see if the provision lock exists. If it does it means our box is already setup and we shouldn&#8217;t configure our environment again.</li>
<li>If the lock file does not exist we are create it</li>
<li>Get git and make</li>
<li>Install rbenv and Ruby <code>1.9.3-p194</code> (that was the version I was using when my blog was on an actual machine so I&#8217;ll stick with that for now)</li>
<li>modify the path so it contains the Ruby defined in rbenv</li>
<li>Change the ownership of the .rbenv file from the privileged user (sudo) to vagrant &#8211; if you don&#8217;t do this, you will not be able to use the gem files when you ssh into the box later on.</li>
<li>Rehash rbenv so it uses the right Ruby version and install the bundler gem as the vagrant user</li>
<li>Install the files required to run octopress (as it says in the comment, I really don&#8217;t like the sudo su - vagrant commands)</li>
</ol>


<h2>Running the machine</h2>

<p>Once everything is setup, you can simply say <code>vagrant up</code>. Vagrant will then run through the Vagrantfile and the script to configure the environment. Once the configuration is complete, you can say <code>vagrant ssh</code>. Once you are ssh&#8217;d into the box, you can <code>cd octopress</code>, <code>rake generate</code>, <code>rake preview</code>, etc (see <a href="http://octopress.org/docs/blogging/">Octopress docs</a> for more information). When finished, <code>vagrant halt</code> will shut down the VM. If you need to destroy the box, you simply can type <code>vagrant destroy</code>. Removing the machine does not remove the code in the synced folders or the Vagrant scripts. Running <code>vagrant up</code> will configure the machine all over again and your code will still be intact where you left off.</p>

<h2>Finishing up</h2>

<p>I have tossed this <a href="https://github.com/ryanlanciaux/octopress-vagrant">Octopress Vagrantfile and provision script on github</a>. For more information on Vagrant, check out the <a href="http://www.vagrantup.com">Vagrant site</a>. Of further note, I referenced <a href="https://github.com/junwatu/nodejs-vagrant">junwatu&#8217;s Vagrant script</a> when writing the Octopress script. Please feel free to <a href="https://github.com/ryanlanciaux/ryanlanciaux.github.com">submit pull requests</a> for any corrections that you may have to this content.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ryan Lanciaux</span></span>

      








  


<time datetime="2014-05-13T03:59:00+00:00" pubdate data-updated="true">May 13<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/octopress/'>octopress</a>, <a class='category' href='/blog/categories/vagrant/'>vagrant</a>, <a class='category' href='/blog/categories/virtual/'>virtual</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://ryanlanciaux.github.com/blog/2014/05/13/vagrantfile-for-octopress/" data-via="ryanlanciaux" data-counturl="http://ryanlanciaux.github.com/blog/2014/05/13/vagrantfile-for-octopress/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/03/06/-thoughts-on-microsoft-surface/" title="Previous Post: Thoughts on Microsoft Surface">&laquo; Thoughts on Microsoft Surface</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/05/15/running-ssh-agent-on-windows/" title="Next Post: Running ssh-agent on Windows">Running ssh-agent on Windows &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/17/miscellaneous-jest-issues-slash-workarouds-ii/">Miscellaneous Jest Issues/Workarouds II</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/28/miscellaneous-jest-issues-slash-workarounds/">Miscellaneous Jest Issues/Workarounds</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/28/react-plus-jest-testing-on-windows-ii/">React + Jest Testing on Windows II</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/18/azure-active-directory-authentication-in-existing-project/">Azure Active Directory authentication in existing project</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/02/using-jest-for-testing-react-components-on-windows/">Test React Components Using Jest (on Windows)</a>
      </li>
    
  </ul>
</section>
<section class='goodreads-aside'>
  <h1><a href="http://www.goodreads.com" target="_blank">Status on Goodreads</a></h1>
  <ul>
    <li>
            <a href='http://www.goodreads.com/user_status/show/47285993' target='blank'>Ryan is 46% done with Getting Started with </a>
            <span class='tiny'>(2014-08-02)</span></li><li>
            <a href='http://www.goodreads.com/user_status/show/47285988' target='blank'>Ryan is finished with Tuck</a>
            <span class='tiny'>(2014-08-02)</span></li><li>
            <a href='http://www.goodreads.com/user_status/show/46065249' target='blank'>Ryan is on page 103 of 452 of Tuck</a>
            <span class='tiny'>(2014-07-07)</span></li>
  </ul>
</section>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/ryanlanciaux">@ryanlanciaux</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ryanlanciaux',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Ryan Lanciaux -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ryanlanciaux';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ryanlanciaux.github.com/blog/2014/05/13/vagrantfile-for-octopress/';
        var disqus_url = 'http://ryanlanciaux.github.com/blog/2014/05/13/vagrantfile-for-octopress/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
