{"data":{"site":{"siteMetadata":{"title":"Ryan Lanciaux","author":"Ryan Lanciaux"}},"markdownRemark":{"id":"b37fda5a-94f4-5b72-9f6c-a09d6a2f1d46","excerpt":"I’ve recently started using  Vagrant  for managing lightweight virtual machines for various projects. Vagrant is awesome because it allows you to: Configure an…","html":"<p>I’ve recently started using <a href=\"http://www.vagrantup.com\">Vagrant</a> for managing lightweight virtual machines for various projects. Vagrant is awesome because it allows you to:</p>\n<ol>\n<li><strong>Configure an environment for a specific project / application</strong> — For instance, if you want to install Ruby / Rails and a mongo database, you can set up an environment specifically for your project. You don’t need to worry about messing up another project’s requirements because each project can have it’s own!</li>\n<li><strong>Save system resources</strong> — Vagrant starts Virtual Machines in headless mode (no UI) — the VM I’m using for my blog (which we’ll see more in a second) is only using 512megs of RAM and it runs without any hiccups. Additionally, these VMs take virtually no hard-drive space when you are not using them. When you’re done using a machine, you can remove it, keeping only the Vagrantfile and provision scripts. Your scripts can be run later on and your environment will be setup exactly as it was the last time it was configured. </li>\n<li><strong>Edit all your code from your host machine</strong> — Often times with development VMs, I would treat the machine as if it was a standalone computer (installing vim / sublime, etc. etc). Using Vagrant, however, you can edit the code on the host machine and simply run/serve the application with the VM (it should be noted you definitely could do this with standard VMs — it’s just a bit easier with Vagrant). As a developer who is pretty OCD about IDE configuration, this is a fantastic feature. </li>\n<li><strong>Easily share machines with other developers</strong> — Vagrant cuts down on the need for sharing giant virtual machines between different computers / developers. You can simply share your Vagrantfile and provision scripts and you have the same environment on any machine (assuming that machine can run Vagrant, etc.). </li>\n</ol>\n<h2>Vagrant File</h2>\n<p>We are going to walk through the Vagrantfile and provisioning script I’m using for my blog. First off, the <a href=\"https://docs.vagrantup.com/v2/vagrantfile/index.html\">Vagrantfile</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">VAGRANTFILE_API_VERSION = &quot;2&quot;\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = &quot;precise64&quot;\n  config.vm.box_url = &quot;http://files.vagrantup.com/precise64.box&quot;\n\n  config.vm.provision :shell, :path =&gt; &quot;bootstrap.sh&quot;\n  config.vm.network :private_network, ip: &#39;10.0.33.36&#39;\n  config.ssh.forward_agent = true\n\n  config.vm.synced_folder &quot;../octopress&quot;, &quot;/home/vagrant/octopress&quot;, create: false\n\n  config.vm.provider :virtualbox do |vb|\n    vb.customize [&quot;setextradata&quot;, :id, &quot;VBoxInternal2/SharedFoldersEnableSymlinksCreate/v-root&quot;, &quot;1&quot;]\n    vb.customize [&quot;modifyvm&quot;, :id, &quot;--memory&quot;, &quot;512&quot;]\n  end\nend</code></pre></div>\n<p>Vagrant files are written in Ruby, however, you don’t need to know Ruby to use Vagrant — the configuration code is nothing too crazy. Lets walk through some of the more interesting parts of the Vagrantfile…</p>\n<h4>Box settings</h4>\n<p>The first thing we are doing in the configuration block is defining the type of machine to use. Precise64 is a 64bit Ubuntu 12.04 machine. I generally use this one but there are <a href=\"https://vagrantcloud.com/discover/featured\">quite a few to choose from</a> in the <a href=\"https://vagrantcloud.com/\">Vagrant Cloud</a>. With <code class=\"language-text\">box_url</code> we are describing where this box can be downloaded if it is not currently available on the host machine. </p>\n<h4>Provision settings</h4>\n<p>Next, we are telling Vagrant to run this <code class=\"language-text\">bootstrap.sh</code> as part of it’s <a href=\"https://docs.vagrantup.com/v2/provisioning/index.html\">provisioning</a> process. Provisioning is where we will define what the environment should look like so it’s not just a base Ubuntu machine. You can provision a Vagrant box with Chef, Puppet, etc. but for this post I’m just using a shell script (still learning Chef). We will take a look at this shell script in a little bit. </p>\n<h4>Network / Sync settings</h4>\n<p>Following the vm configuration, we are setting up the networking and folder options for our box. The <code class=\"language-text\">vm.network</code> property is stating that when there is a webserver running on this machine, we can access it on our host browser at ‘10.0.33.36’. The <code class=\"language-text\">synced_folder</code> property is stating that the folder <code class=\"language-text\">octopress</code> living in a sibling folder to the folder that the Vagrantfile is contained in should be accessible within the virtual machine as <code class=\"language-text\">~/octopress</code>. The octopress directory already exists (and has it’s own github repo) so we do not want to recreate it. </p>\n<h4>Additional settings</h4>\n<p>Finally, in the provider block toward the bottom of this script we are adjusting the memory used and setting a property that allows us to use symbolic links. </p>\n<h2>Provisioning Script</h2>\n<p>As we talked about earlier, the provisioning script is what differentiates our box from a base Ubuntu machine. In the case of this example it’s basically just a shell script. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#!/usr/bin/env bash\nHOME=&quot;/home/vagrant&quot;\nPROV_FILE=.vagrant_provision.lock\n\n#inspired by https://github.com/junwatu/nodejs-vagrant \nif [ -f $PROV_FILE ];\nthen\n    echo &quot;Already Provisioned&quot;\nelse\n    touch $PROV_FILE\n\n    sudo apt-get install -y git make\n\n    git clone https://github.com/sstephenson/rbenv.git $HOME/.rbenv\n\n    # Install ruby-build\n    git clone https://github.com/sstephenson/ruby-build.git $HOME/.rbenv/plugins/ruby-build\n\n    $HOME/.rbenv/bin/rbenv install 1.9.3-p194\n    $HOME/.rbenv/bin/rbenv global 1.9.3-p194\n\n    #Add rbenv to PATH\n    echo &#39;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&#39; &gt;&gt; $HOME/.profile\n    echo &#39;eval &quot;$(rbenv init -)&quot;&#39; &gt;&gt; $HOME/.profile\n\n    #own rbenv as the vagrant user\n    sudo chown -Rf vagrant $HOME/.rbenv\n\n    #don&#39;t like doing this\n    sudo su - vagrant -c &quot;rbenv rehash &amp;&amp; cd /home/vagrant/octopress/ &amp;&amp; gem install bundler&quot;\n    sudo su - vagrant -c &quot;cd /home/vagrant/octopress/ &amp;&amp; bundle install&quot;\nfi</code></pre></div>\n<p>I’m not going to spend as much time on this as it’s not too interesting if you know shell scripting (and there is probably a better way to do a lot of this). </p>\n<ol>\n<li>Check to see if the provision lock exists. If it does it means our box is already setup and we shouldn’t configure our environment again. </li>\n<li>If the lock file does not exist we are create it </li>\n<li>Get git and make</li>\n<li>Install rbenv and Ruby <code class=\"language-text\">1.9.3-p194</code> (that was the version I was using when my blog was on an actual machine so I’ll stick with that for now)</li>\n<li>modify the path so it contains the Ruby defined in rbenv</li>\n<li>Change the ownership of the .rbenv file from the privileged user (sudo) to vagrant — if you don’t do this, you will not be able to use the gem files when you ssh into the box later on. </li>\n<li>Rehash rbenv so it uses the right Ruby version and install the bundler gem as the vagrant user</li>\n<li>Install the files required to run octopress (as it says in the comment, I really don’t like the sudo su - vagrant commands)</li>\n</ol>\n<h2>Running the machine</h2>\n<p>Once everything is setup, you can simply say <code class=\"language-text\">vagrant up</code>. Vagrant will then run through the Vagrantfile and the script to configure the environment. Once the configuration is complete, you can say <code class=\"language-text\">vagrant ssh</code>. Once you are ssh’d into the box, you can <code class=\"language-text\">cd octopress</code>, <code class=\"language-text\">rake generate</code>, <code class=\"language-text\">rake preview</code>, etc (see <a href=\"http://octopress.org/docs/blogging/\">Octopress docs</a> for more information). When finished, <code class=\"language-text\">vagrant halt</code> will shut down the VM. If you need to destroy the box, you simply can type <code class=\"language-text\">vagrant destroy</code>. Removing the machine does not remove the code in the synced folders or the Vagrant scripts. Running <code class=\"language-text\">vagrant up</code> will configure the machine all over again and your code will still be intact where you left off.</p>\n<h2>Finishing up</h2>\n<p>I have tossed this <a href=\"https://github.com/ryanlanciaux/octopress-vagrant\">Octopress Vagrantfile and provision script on github</a>. For more information on Vagrant, check out the <a href=\"http://www.vagrantup.com\">Vagrant site</a>. Of further note, I referenced <a href=\"https://github.com/junwatu/nodejs-vagrant\">junwatu’s Vagrant script</a> when writing the Octopress script. Please feel free to <a href=\"https://github.com/ryanlanciaux/ryanlanciaux.github.com\">submit pull requests</a> for any corrections that you may have to this content. </p>","frontmatter":{"title":"Vagrantfile for Octopress","date":"May 13, 2014","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog//2014-05-13-vagrantfile-for-octopress/","previous":{"fields":{"slug":"/blog//2014-03-06--thoughts-on-microsoft-surface/"},"frontmatter":{"title":"Thoughts on Microsoft Surface"}},"next":{"fields":{"slug":"/blog//2014-05-15-running-ssh-agent-on-windows/"},"frontmatter":{"title":"Running ssh-agent on Windows"}}}}